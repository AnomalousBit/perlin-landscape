<html>

<head>
    <script src="js/three.min.js"></script>
    <script src="js/controls/FirstPersonControls.js"></script>
</head>

<body style='background-color:black;'>
<script>

    var camera, scene, renderer;
    var geometry, material, mesh;
    var light, terrain;
    var controls, clock, delta;


    init();
    animate();

    function init() {

        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.05, 100000 );
        camera.position.z = 1000;
        camera.rotation = new THREE.Vector3(0,0,0);
        // -338, 90, 400 is the center of the terrain

        controls = new THREE.FirstPersonControls(camera);
        controls.movementSpeed = 1000;
        controls.lookSpeed = 0.125;
        controls.lookVertical = true;
        clock = new THREE.Clock();

        scene = new THREE.Scene();

        light = new THREE.AmbientLight( 0xffffff ); 
        light.position = new THREE.Vector3(200, 800, 2000);
        scene.add( light );




        var vertexArray = generateMeshVertexArray(28,28);
        material = new THREE.MeshLambertMaterial( { color: 0x0077dd, doubleSided: true } );
        terrain = new THREE.Mesh(buildGeomObject(vertexArray), material );

        terrain.rotation.z = Math.PI;
        scene.add(terrain);


        geometry = new THREE.CubeGeometry( 200, 200, 200 );
        //material = new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe: true } );
        mesh = new THREE.Mesh( geometry, material );
        scene.add( mesh );




        renderer = new THREE.CanvasRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );

        document.body.appendChild( renderer.domElement );

    }



    function animate() 
    {
        // note: three.js includes requestAnimationFrame shim
        requestAnimationFrame( animate );

        delta = clock.getDelta();
        controls.update(delta);

        /*
        terrain.rotation.x += 0.01;
        terrain.rotation.y += 0.02;
        */


        renderer.render( scene, camera );

    }



    function generateMeshVertexArray(width, height)
    {
        var spaceInbetweenGridPoints = 100;
        var vertexArray = new Array();

        for (var i = 0; i < width; i++)
        { 
            vertexArray[i] = new Array(); 

            for (var j = 0; j < height; j++)
            {
                vertexArray[i][j] = new THREE.Vector3(i*spaceInbetweenGridPoints
                                                     ,Math.random() * 1000000000 % 40
                                                     ,j*spaceInbetweenGridPoints); 
            }
        }

        return vertexArray;
    }



    function buildGeomObject(vertexArray)
    {
        var geom = new THREE.Geometry(); 

        for (var i = 0; i < vertexArray.length; i++)
        {
            for (var j = 0; j < vertexArray[i].length; j++)
            { geom.vertices.push(vertexArray[i][j]); } //push all our verticies into the geom array
        }

        // this math maybe assumes width and height of the grid/array are equal
        var facesPerRow = vertexArray.length - 1;
        var facesPerColumn = vertexArray[0].length - 1;
        var verticiesPerRow = vertexArray.length; 
        var verticiesPerColumn = vertexArray[0].length; 

        for (var j = 0; j < (facesPerColumn * verticiesPerRow); j = j + verticiesPerColumn) // loop doing the vertex column index 
        {
            for (var i = 0; i < facesPerRow; i++) // loop doing the vertex row index
            { 
                var face = new THREE.Face4( i + j, i + j + verticiesPerRow, i + j + verticiesPerRow + 1, i + j + 1)
                geom.faces.push(face); 

                /* handy for seeing your face definitions
                console.log("i: " + i);
                console.log("j: " + j);
                console.log("Face4:");
                console.log(face);
                */
            }
        }

        geom.computeFaceNormals();
        geom.computeVertexNormals();

        return geom;

        /*
        . . . .
        . . . .
        . . . .
        . . . .

        geom.faces.push( new THREE.Face4( 0, 4, 5, 1) );
        geom.faces.push( new THREE.Face4( 1, 5, 6, 2) );
        geom.faces.push( new THREE.Face4( 2, 6, 7, 3) );

        geom.faces.push( new THREE.Face4( 4, 8, 9, 5) );
        geom.faces.push( new THREE.Face4( 5, 9, 10, 6) );
        geom.faces.push( new THREE.Face4( 6, 10, 11, 7) );

        geom.faces.push( new THREE.Face4( 8, 9, 12, 13) );
        geom.faces.push( new THREE.Face4( 9, 10, 13, 14) );
        geom.faces.push( new THREE.Face4( 10, 11, 14, 15) );
        */

    }

</script>
</body>

</html>

